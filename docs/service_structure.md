# üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ StoryGraph

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ **StoryGraph**, –≤–∫–ª—é—á–∞—è –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

---

## üóÇÔ∏è –ö–æ—Ä–Ω–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
.
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ docs/
‚îî‚îÄ‚îÄ app/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ main.py
    ‚îú‚îÄ‚îÄ config/
    ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îú‚îÄ‚îÄ settings.py
    ‚îÇ   ‚îî‚îÄ‚îÄ clients/
    ‚îú‚îÄ‚îÄ api/
    ‚îú‚îÄ‚îÄ core/
    ‚îú‚îÄ‚îÄ services/
    ‚îú‚îÄ‚îÄ schemas/
    ‚îú‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ tests/
```

---

## üìÅ –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞

| –§–∞–π–ª                  | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------------------|------------|
| `.env`                | –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è –∫–ª—é—á–∏ –∏ —Ç–æ–∫–µ–Ω—ã. –ù–µ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è. |
| `Dockerfile`          | –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. |
| `docker-compose.yml`  | –°—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –∏ –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Weaviate, Neo4j). |
| `README.md`           | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. |

---

## üìÅ app/

–ì–ª–∞–≤–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è Python-–∫–æ–¥–∞.

### `main.py`

- –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `FastAPI` –æ–±—ä–µ–∫—Ç –∏–∑ `core/router.py`.

---

## üìÅ app/config/

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∫–ª–∏–µ–Ω—Ç—ã –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

### `settings.py`

- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env` —á–µ—Ä–µ–∑ `pydantic_settings.BaseSettings`.
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ OpenAI, Neo4j, Weaviate, Langfuse –∏ —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

- `openai.py` ‚Äî –∫–ª–∏–µ–Ω—Ç –¥–ª—è OpenAI API.
- `neo4j.py` ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –¥—Ä–∞–π–≤–µ—Ä Neo4j.
- `weaviate.py` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è Weaviate API.
- `langfuse.py` ‚Äî —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ LLM-–∑–∞–ø—Ä–æ—Å–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ).

---

## üìÅ app/core/

–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞.

- `auth.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ Bearer-—Ç–æ–∫–µ–Ω–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ.
- `router.py` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FastAPI –∏ –≤—Å–µ—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤.

---

## üìÅ app/services/

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.

- `extraction.py` ‚Äî Pipeline `extract-save`.
- `pipeline.py` ‚Äî –ø–∞–π–ø–ª–∞–π–Ω—ã `extract-save` –∏ `augment-context`.
- `template_service.py` ‚Äî –ü–æ–∏—Å–∫ —à–∞–±–ª–æ–Ω–æ–≤ —á–µ—Ä–µ–∑ Weaviate.
- `slot_filler.py` ‚Äî –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–ª–æ—Ç–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ LLM.
- `graph_proxy.py` ‚Äî –†–∞–±–æ—Ç–∞ —Å Neo4j –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Cypher-–∑–∞–ø—Ä–æ—Å–æ–≤.

---

## üìÅ app/schemas/

–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ (Pydantic).

- `extract.py` ‚Äî —Å—Ö–µ–º—ã –¥–ª—è `/v1/extract-save`.
- `template.py` ‚Äî —Å—Ö–µ–º—ã —à–∞–±–ª–æ–Ω–æ–≤ `CypherTemplate`.

---

## üìÅ app/utils/

–£—Ç–∏–ª–∏—Ç—ã –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.

- `jinja.py` ‚Äî —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —à–∞–±–ª–æ–Ω–æ–≤ Jinja2.
- `logger.py` ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
- `helpers.py` ‚Äî –æ–±—â–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è UUID, –¥–∞—Ç—ã).

---

## üìÅ app/tests/

–¢–µ—Å—Ç—ã (unit + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ).

- `test_extraction.py` ‚Äî —Ç–µ—Å—Ç—ã `extract-save`.
- `test_augmentation.py` ‚Äî —Ç–µ—Å—Ç—ã `augment-context`.
- `test_templates.py` ‚Äî –ø–æ–≤–µ–¥–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤.
- `conftest.py` ‚Äî —Ñ–∏–∫—Å—Ç—É—Ä—ã –∏ –æ–±—â–∏–π setup.

---

## üß© –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —Å–ª–æ–∏ –æ–ø–∏—Å–∞–Ω—ã –≤ `README.md` –∏ —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö.
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `ChunkNode` –∏ `RaptorNode`, –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ `Fact`.
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≥—Ä–∞—Ñ–æ–≤–æ–π –ë–î Neo4j.