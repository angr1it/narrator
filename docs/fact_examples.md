# üìö –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Fact-–Ω–æ–¥—ã —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º

## üß© –ü—Ä–∏–º–µ—Ä 1: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∞–ª—å—è–Ω—Å–∞ –∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ –ø—Ä–∞–≤–¥—ã

**–í—Ö–æ–¥–Ω–æ–π —Ç–µ–∫—Å—Ç:**

> ¬´–í –≥–ª–∞–≤–µ 15 –ê—Ä–µ–Ω —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç –∫–ª—è—Ç–≤—É —Å –î–æ–º–æ–º –ó–∞—Ä–∏, –∑–∞—è–≤–ª—è—è, —á—Ç–æ –∏—Ö —É—á–µ–Ω–∏—è –±—ã–ª–∏ –ª–æ–∂—å—é. –û–Ω —Ç–µ–ø–µ—Ä—å –æ—Ç–∫—Ä—ã—Ç–æ —Å–∏–º–ø–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –°–µ–≤–µ—Ä–Ω–æ–º—É —Ñ—Ä–æ–Ω—Ç—É.¬ª

**–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:** `chapter=15`, `tags=["—Ä–∞–∑—Ä—ã–≤", "–∞–ª—å—è–Ω—Å", "—Ä–∞—Å–∫—Ä—ã—Ç–∏–µ"]`

### –≠—Ç–∞–ø—ã:

#### 1. –®–∞–±–ª–æ–Ω—ã:
- `break_faction_allegiance` ‚Üí —Å—Ç–∞—Ä—ã–π —Å–æ—é–∑
- `declare_loyalty` ‚Üí –Ω–æ–≤—ã–π —Å–æ—é–∑

#### 2. –ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ `slots`:
- `character=–ê—Ä–µ–Ω`, `faction=–î–æ–º –ó–∞—Ä–∏`
- `character=–ê—Ä–µ–Ω`, `faction=–°–µ–≤–µ—Ä–Ω—ã–π —Ñ—Ä–æ–Ω—Ç`

#### 3. –†–µ—à–µ–Ω–∏–µ LLM:
> _–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±–∞ –∫–∞–∫ versioned facts? ‚Üí ‚úÖ –î–∞_

#### 4. –í—Å—Ç–∞–≤–∫–∞ –¥–≤—É—Ö —Ñ–∞–∫—Ç–æ–≤:

```json
{
  "subject_id": "–ê—Ä–µ–Ω",
  "object_id": "–î–æ–º –ó–∞—Ä–∏",
  "type": "MEMBER_OF",
  "value": "–ø—Ä–µ–∫—Ä–∞—â–µ–Ω–æ",
  "chapter": 15,
  "summary": "–ê—Ä–µ–Ω –ø–æ–∫–∏–Ω—É–ª –î–æ–º –ó–∞—Ä–∏"
}
```

```json
{
  "subject_id": "–ê—Ä–µ–Ω",
  "object_id": "–°–µ–≤–µ—Ä–Ω—ã–π —Ñ—Ä–æ–Ω—Ç",
  "type": "MEMBER_OF",
  "value": "–Ω–æ–≤—ã–π —Å–æ—é–∑",
  "chapter": 15,
  "summary": "–ê—Ä–µ–Ω –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –°–µ–≤–µ—Ä–Ω–æ–º—É —Ñ—Ä–æ–Ω—Ç—É"
}
```

---

## üì§ –ü—Ä–∏–º–µ—Ä 2: –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ñ–∞–∫—Ç–∞–º –≤–ª–∏—è–Ω–∏—è –∏ —á–µ—Ä—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

**–í—Ö–æ–¥–Ω–æ–π —Ç–µ–∫—Å—Ç:**

> ¬´–≠—Ä–∏–∫ –∫–æ–ª–µ–±–ª–µ—Ç—Å—è. –û–Ω –±–æ–ª—å—à–µ –Ω–µ —É–≤–µ—Ä–µ–Ω, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ –µ–≥–æ —Ä–µ—à–µ–Ω–∏—è ‚Äî –µ–≥–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ. –ß—Ç–æ –±—ã —Å–∫–∞–∑–∞–ª–∞ –ú–∏—Ä–∞–Ω–¥–∞?¬ª

**–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:** `chapter=19`, `tags=["–∫–æ–Ω—Ñ–ª–∏–∫—Ç", "—Ä–µ—à–µ–Ω–∏–µ"]`

### –≠—Ç–∞–ø—ã:

#### 1. –í–æ–ø—Ä–æ—Å—ã –æ—Ç LLM:
- –ö–∞–∫–∏–µ —á–µ—Ä—Ç—ã –µ—Å—Ç—å —É –ú–∏—Ä–∞–Ω–¥—ã?
- –ü–æ–¥—á–∏–Ω—ë–Ω –ª–∏ —Å–µ–π—á–∞—Å –≠—Ä–∏–∫ –µ—ë –≤–ª–∏—è–Ω–∏—é?

#### 2. SELECT-—à–∞–±–ª–æ–Ω—ã:
- `select_fact_trait` ‚Üí `HAS_TRAIT`
- `select_fact_influence` ‚Üí `INFLUENCE`

#### 3. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ `slots`:

```json
{ "subject": "–ú–∏—Ä–∞–Ω–¥–∞", "chapter": 19 }
{ "subject": "–ú–∏—Ä–∞–Ω–¥–∞", "target": "–≠—Ä–∏–∫", "chapter": 19 }
```

#### 4. Cypher-–∑–∞–ø—Ä–æ—Å—ã:

```cypher
MATCH (f:Fact)
WHERE f.subject_id = '–ú–∏—Ä–∞–Ω–¥–∞'
  AND f.type = 'HAS_TRAIT'
  AND f.from_chapter <= 19
  AND (f.to_chapter IS NULL OR f.to_chapter >= 19)
RETURN f
```

```cypher
MATCH (f:Fact)
WHERE f.subject_id = '–ú–∏—Ä–∞–Ω–¥–∞'
  AND f.object_id = '–≠—Ä–∏–∫'
  AND f.type = 'INFLUENCE'
  AND f.from_chapter <= 19
  AND (f.to_chapter IS NULL OR f.to_chapter >= 19)
RETURN f
```

#### 5. –†–µ–∑—É–ª—å—Ç–∞—Ç:

```json
{
  "context": {
    "traits": {
      "–ú–∏—Ä–∞–Ω–¥–∞": ["—Ç–µ–ª–µ–ø–∞—Ç–∏—è"]
    },
    "influence": {
      "–ú–∏—Ä–∞–Ω–¥–∞ ‚Üí –≠—Ä–∏–∫": "–∫–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ —Ç–µ–ª–µ–ø–∞—Ç–∏—é (–≥–ª–∞–≤–∞ 18‚Äì...)"
    }
  }
}
```

> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–µ –¥–ª—è LLM –≤ —Å—Ü–µ–Ω–µ –≥–ª–∞–≤—ã 19.