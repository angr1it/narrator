# Bug Report: draft_stage stored as string

## Проблема
`/extract-save` сохраняет `draft_stage` как строку, хотя запросы на сравн
ение в `/augment` предполагают числовое значение. В результате фильтры `r.draft_stage >= ...` не работают.

## Контекст
Ошибка проявляется при выполнении шаблонов из `app/templates/cypher/_augment_filters.j2`.
Логи показывают, что в базе свойства записаны строками, например `brainstorm`,
но запросы сравнивают эти значения как числа. Код `ExtractionPipeline` вставля
ет `stage.name`, а не `stage.value`.

## Причина
Неверный тип значения при создании узлов и отношений в графе. Шаблоны также об
орачивают `draft_stage` в кавычки, принудительно приводя его к строке.

## Последствия
Сравнения по `draft_stage` дают пустые результаты, нарушая работу `/augment`.

## Планируемые изменения
- В `ExtractionPipeline` сохранять `stage.value` вместо `stage.name`.
- Исправить Jinja-шаблон `_relation_meta.j2`, убрав кавычки вокруг `draft_stage`.
- Обновить фильтр в `_augment_filters.j2` на числовое сравнение.
- Поправить тесты и документацию.

## Локация
- `app/services/pipeline.py`
- `app/templates/cypher/_relation_meta.j2`
- `app/templates/cypher/_augment_filters.j2`
- `app/tests/*`

## Улучшения
Сделать поля `chapter` и `draft_stage` опциональными в шаблонах, чтобы
отсутствие значений не мешало получению данных.

## Проверка
- Запуск `pytest -q` после правок.
- Проверить, что запросы `/augment` возвращают строки без указания `chapter` и `stage`.

## Отчёт
Поле `draft_stage` теперь хранится как число. Фильтры сравнивают числовые значения, а параметры `chapter` и `draft_stage` в шаблонах необязательны.
