# AGENTS.md

Файл задаёт основные правила работы с репозиторием. Вложенные AGENTS.md могут переопределять эти инструкции.

## Структура проекта
- `app/api` — роуты FastAPI
- `app/services` — бизнес-логика и пайплайны
- `app/schemas` — Pydantic-модели
- `app/config` — настройки и клиенты внешних сервисов
- `app/core` — авторизация и общие компоненты
- `app/utils` — Jinja-шаблоны, логгер, хелперы
- `app/templates` — базовые Jinja2-шаблоны
- `app/tests` — unit и интеграционные тесты
- `docs/` — документация
- `main.py` — точка входа

## Код-стайл
- PEP8 и обязательные аннотации типов
- Форматирование — `black`
- Линтер — `flake8`
- Используйте f-строки
- В Pydantic `Field()` заполняйте `description`
- Для логирования подключайте `get_logger` из `app.utils.logger`

## Тестирование
- Запуск тестов: `pytest -q`
- Фикстура `event_loop` находится в `app/tests/conftest.py`
- Интеграционные тесты требуют реальные ключи OpenAI и Weaviate; при их отсутствии помечаются как `skipped`
- Юнит‑тесты лежат в `app/tests/services/unit`. Они полностью мокают внешние сервисы (БД, LLM, эмбеддинги). Используйте фикстуры из `conftest.py` и не обращайтесь к реальным переменным окружения.
- Следуйте TDD: при добавлении новых классов или методов сразу пишите минимальные юнит‑тесты для проверки их логики.

## Pull request
- Заголовок — короткий глагол в повелительной форме
- Описание включает разделы `## Summary` и `## Testing`

## Обязательные проверки перед слиянием
- `black --check .`
- `flake8`
- `pytest -q`
